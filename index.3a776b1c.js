let e=[],t={time1:0,time2:0,time3:0,time4:0,weekend:!1};function i(){document.getElementById("time1").value=this.getAttribute("data-tariff1"),document.getElementById("time2").value=this.getAttribute("data-tariff2"),document.getElementById("time3").value=this.getAttribute("data-tariff3"),document.getElementById("time4").value=this.getAttribute("data-tariff4"),"1"===this.getAttribute("data-weekend")?document.getElementById("weekend").checked=!0:document.getElementById("weekend").checked=!1}document.getElementById("csvFile").addEventListener("change",function(t){Papa.parse(t.target.files[0],{header:!0,dynamicTyping:!0,complete:function(t){e=t.data}})}),document.getElementById("calculate").addEventListener("click",function(){let i,a,n;if(t.time1=document.getElementById("time1").value,t.time2=document.getElementById("time2").value,t.time3=document.getElementById("time3").value,t.time4=document.getElementById("time4").value,t.weekend=document.getElementById("weekend").checked,0===e.length){alert("Please select a CSV file");return}if(!t.time1||!t.time2||!t.time3||!t.time4){alert("Please set all the tariff values");return}if(isNaN(t.time1)||isNaN(t.time2)||isNaN(t.time3)||isNaN(t.time4)){alert("Please set all the tariff values to numbers only");return}if(t.time1<0||t.time2<0||t.time3<0||t.time4<0){alert("Please set all the tariff values to positive numbers");return}document.querySelector(".table-hr").style.display="block",i=0,a={},n={},e.forEach(e=>{if(!e.Date)return;let l=new Date(e.Date.split("/").reverse().join("-")),d=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`,m=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;if(0!==l.getDay()&&6!==l.getDay()||!t.weekend)for(let l in d in a||(a[d]=0),m in n||(n[m]={time1:{kwh:0,cost:0},time2:{kwh:0,cost:0},time3:{kwh:0,cost:0},time4:{kwh:0,cost:0},totalKwh:0,total:0}),e){if(!e.hasOwnProperty(l)||!l.includes(":"))continue;let o=parseFloat(e[l]);isNaN(o)&&(o=0);let r=(l>="02:00"&&l<"04:00"?parseFloat(t.time4):l>="17:00"&&l<"19:00"?parseFloat(t.time2):l>="08:00"&&l<"23:00"?parseFloat(t.time1):parseFloat(t.time3))*o/100;a[d]+=r,i+=r,l>="02:00"&&l<"04:00"?(n[m].time4.kwh+=o,n[m].time4.cost+=r):l>="17:00"&&l<"19:00"?(n[m].time2.kwh+=o,n[m].time2.cost+=r):l>="08:00"&&l<"23:00"?(n[m].time1.kwh+=o,n[m].time1.cost+=r):(n[m].time3.kwh+=o,n[m].time3.cost+=r),n[m].total+=r,n[m].totalKwh+=o}}),function(e,t,i){let a=document.getElementById("tableBody");a.innerHTML="";let n=document.createElement("tr");n.innerHTML=`<td colspan="2">Total</td><td>${e.toFixed(2)}</td>`,a.appendChild(n),Object.keys(t).sort().forEach(e=>{let[i,n]=e.split("-"),l=new Date(i,n-1,1),d=new Intl.DateTimeFormat("en-US",{month:"long",year:"numeric"}).format(l),m=document.createElement("tr");m.innerHTML=`<td colspan="2">${d}</td><td>${t[e].toFixed(2)}</td>`,a.appendChild(m)});let l={time1:"08:00 to 23:00",time2:"17:00 to 19:00",time3:"23:00 to 08:00",time4:"02:00 to 04:00"};for(let e in i){let t=document.createElement("tr"),n='<div style="display:flex;">';for(let t in i[e]){if("total"===t||"totalKwh"===t)continue;let a=i[e][t];n+=`<div class="timePeriod"><h3>${l[t]}</h3><p>${a.kwh.toFixed(2)} kwh</p><p>${a.cost.toFixed(2)} &euro;</p></div>`}n+=`
        <div class="timePeriod">
            <h3>Total</h3>
            <p>${i[e].totalKwh.toFixed(2)} kwh</p>
            <p>${i[e].total.toFixed(2)} &euro;</p>
        </div></div>`,t.innerHTML=`<td>${e}</td><td colspan="2">${n}</td>`,a.appendChild(t)}}(i,a,n)}),document.querySelectorAll(".tariff-buttons button").forEach(e=>e.addEventListener("click",i));